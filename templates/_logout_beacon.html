<script>
    (function () {
        var role = "{{ role|e }}";
        var navigating = false;

        function sendLogout() {
            try { navigator.sendBeacon("/logout/" + role); } catch (e) {}
        }

        document.addEventListener("submit", function () { navigating = true; }, true);
        document.addEventListener("click", function (e) {
            if (e.target && e.target.closest("a, button, input[type=submit]")) navigating = true;
        }, true);

        window.addEventListener("pagehide", function () {
            if (!navigating) sendLogout();
        });
    })();
</script>
