{% if entries %}

{% set grouped = {} %}

{# ---- Group entries by IP ---- #}
{% for e in entries %}
{% set ip = e.ip %}
{% if ip not in grouped %}
{% set _ = grouped.update({ ip: [] }) %}
{% endif %}
{% set _ = grouped[ip].append(e) %}
{% endfor %}

<h2>Collected Data (Grouped by IP)</h2>

{% for ip, group in grouped.items() %}
<div style="margin-bottom: 35px; padding: 10px; border: 2px solid #ccc;">

    <h3>
        {{ ip }}
        {% if group[0].geo %}
        ({{ group[0].geo.city or "Unknown" }},
        {{ group[0].geo.region or "Unknown" }},
        {{ group[0].geo.country or "Unknown" }})
        {% endif %}
    </h3>

    <table>
        <thead>
        <tr>
            <th>Timestamp (Central Time)</th>
            <th>Inputs</th>
        </tr>
        </thead>
        <tbody>
        {% for e in group %}
        <tr>
            <td>{{ e.timestamp }}</td>
            <td class="input-box">
                <strong>Single Sites:</strong> {{ e.input.int1 }}
                <strong>Double Sites:</strong> {{ e.input.int2 }}
                <strong>Triple Sites:</strong> {{ e.input.int3 }}
                <strong>Cars:</strong> {{ e.input.int4 }}
                <strong>Vans:</strong> {{ e.input.int5 }}
                <strong>Bus Capacities:</strong> {{ e.input.int_list }}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</div>
{% endfor %}

{% else %}
<p>No entries logged yet.</p>
{% endif %}
